<!DOCTYPE html>
<html lang="en">

<head>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-M7CNXDK');</script>
<!-- End Google Tag Manager -->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-11759067-12"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-11759067-12');  
</script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="description" content="Utah Geologic and Mineral Resources">

    <title>Utah Mineral Resources</title>

    <!-- Calcite Maps Bootstrap -->
    <link rel="stylesheet" href="https://esri.github.io/calcite-maps/dist/css/calcite-maps-bootstrap.min-v0.10.css">

    <!-- Calcite Maps -->
    <link rel="stylesheet" href="https://esri.github.io/calcite-maps/dist/css/calcite-maps-arcgis-4.x.min-v0.10.css">
    <!--link rel="stylesheet" href="../../dist/css/calcite-maps.min-v0.10.css"-->
    <!-- works -->

    <!-- ArcGIS JS 4.10 -->
    <link rel="stylesheet" href="https://js.arcgis.com/4.19/esri/css/main.css">
    <link rel="stylesheet" href="lightbox2/dist/css/lightbox.min.css">
    <link  href="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.5.0/viewer.css" rel="stylesheet">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/viewerjs/1.5.0/viewer.js"></script>

    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
        }

        .calcite-panels.calcite-panels-left.calcite-bg-custom.calcite-text-light.calcite-bgcolor-dark.panel-group {
            position: absolute;
            left: 55px;
        }

        .esri-layer-list__item-actions-menu-item:first-of-type {
            display: none;
        }

        .tab {
            margin-left: 4%;
        }

        /* .esri-legend__layer-caption {
            display: none;
        } */

        .esri-legend__message {
            display: none;
        }

        .esri-layer-list__child-toggle+.esri-layer-list__item-label>.esri-layer-list__item-toggle {
            display: none;
        }

        a {
            cursor: pointer;
        }

        .esri-layer-list__item-actions-menu-item--active,
        .esri-layer-list__item-actions-menu-item--active:hover {
            background-color: whitesmoke;
        }

        .calcite-title:before {
            content: url('/apps/jay/tests/UGS-blm.png');
            padding: 6px 12px 0 2px;
            cursor: pointer;
        }



        .esri-layer-list__item-container .tooltiptext {
            visibility: hidden;
            width: 120px;
            background-color: ivory;
            color: #fff;
            text-align: center;
            padding: 5px 0;
            border-radius: 6px;
            position: absolute;
            z-index: 1;
        }

        .esri-layer-list__item-container:hover .tooltiptext {
            visibility: visible;
        }

        .calcite-maps .calcite-search-expander .esri-search__sources-button.esri-widget--button {
            display: block !important;
        }

        .calcite-maps .calcite-search-expanded .esri-menu.esri-search__sources-menu {
            display: block !important;
        }

        .calcite-panels {
            z-index: 1;
        }

        .pictures {
      margin: 0;
      padding: 0;
      list-style: none;
    }
    .pictures > li {
      float: left;
      width: 33.3%;
      height: 33.3%;
      margin: 0 -1px -1px 0;
      border: 1px solid transparent;
      overflow: hidden;
    }
    .pictures > li > img {
      width: 100%;
      cursor: -webkit-zoom-in;
      cursor: zoom-in;
    }

    .viewer-title {
        color: #cd4;
        font-size: 20px;
    }
    </style>

</head>

<body class="calcite-maps calcite-nav-top">

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-M7CNXDK"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

    <!-- Navbar -->
    <a class="ugs-watermark " href="https://geology.utah.gov"></a>
    <nav class="navbar calcite-navbar navbar-fixed-top calcite-text-light calcite-bg-dark calcite-bgcolor-dark">
        <!-- Menu -->
        <div class="dropdown calcite-dropdown calcite-bg-light calcite-text-dark" role="presentation">
            <a class="dropdown-toggle" role="menubutton" aria-haspopup="true" aria-expanded="false" tabindex="0">
                <div class="calcite-dropdown-toggle">
                    <span class="sr-only">Toggle dropdown menu</span>
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </a>
            <ul class="dropdown-menu calcite-menu">
                <li><a class="active hidden-md hidden-lg" href="#mapTab" aria-controls="mapTab" role="tab" data-toggle="tab"> 2D</a></li>
                <li><a class="hidden-md hidden-lg" href="#sceneTab" aria-controls="sceneTab" role="tab" data-toggle="tab"> 3D</a></li>
                <li><a role="menuitem" tabindex="0" data-target="#panelInfo" aria-haspopup="true"><span class="esri-icon-notice-round"></span> About</a></li>
                <li><a role="menuitem" tabindex="0" data-target="#panelDisclaimer" aria-haspopup="true"><span class="esri-icon-notice-triangle"></span> Disclaimer</a></li>
                <li><a role="menuitem" tabindex="0" data-target="#panelLegend" aria-haspopup="true"><span class="glyphicon glyphicon-list-alt"></span> Legend</a></li>
                <li><a role="menuitem" tabindex="0" data-target="#panelBasemaps" aria-haspopup="true"><span class="esri-icon-basemap"></span> Basemaps</a></li>
                <!-- <li><a role="menuitem" tabindex="0" data-target="#calciteLocate" id="calciteLocate" aria-haspopup="true"><span class="glyphicon glyphicon-map-marker"></span> Locate</a></li> -->
                <!-- <li><a role="menuitem" tabindex="0" id="calciteToggleNavbar" aria-haspopup="true"><span class="glyphicon glyphicon-fullscreen"></span> Full Map</a></li> -->
            </ul>
        </div>
        <!-- Title -->
        <div class="calcite-title calcite-overflow-hidden">
            <span class="calcite-title-main">Utah Geological Survey</span>
            <span class="calcite-title-divider hidden-xs"></span>
            <span class="calcite-title-sub hidden-xs">Utah Mineral Resources: Metals and Industrial Minerals</span>
        </div>
        <!-- Nav -->
        <ul class="calcite-nav nav navbar-nav">
            <!-- <li><a id="mapNav" class="hidden-xs hidden-sm" href="#mapTab" aria-controls="mapTab" aria-expanded="true" role="tab" data-toggle="tab" data-tooltip="tip" title="2D View" data-placement="bottom">2D View</a></li>
    <li class="active"><a id="sceneNav" class="hidden-xs hidden-sm" href="#sceneTab" aria-controls="mapTab" role="tab" data-toggle="tab" data-tooltip="tip" title="3D View" data-placement="bottom">3D View</a></li>                   -->
            <li>
                <div class="calcite-navbar-search calcite-search-expander" role="presentation" tabindex="-1">
                    <div id="searchNavDiv" tabindex="0"></div>
                </div>
            </li>
        </ul>
    </nav>
    <!--/.navbar -->

    <!-- Map Container  -->

    <div class="calcite-map calcite-map-absolute">
        <div id="tabContainer" class="tab-content">
            <div id="mapTab" class="tab-pane fade in active" role="tabpanel">
                <div id="mapViewDiv"></div>
            </div>
            <!-- <div id="sceneTab" class="tab-pane fade in active" role="tabpanel">
      <div id="sceneViewDiv"></div>
    </div> -->
        </div>
    </div>

    <!-- Panel Container -->

    <!-- Panel - Legend -->
    <div class="calcite-panels calcite-panels-left calcite-bg-custom calcite-text-light calcite-bgcolor-dark panel-group" role="tablist" aria-multiselectable="true">

        <div id="panelLegend" class="panel collapse in">
            <div id="headingLegend" class="panel-heading" role="tab">
                <div class="panel-title">
                    <a class="panel-toggle" role="button" data-toggle="collapse" href="#collapseLegend" aria-expanded="true" aria-controls="collapseLegend"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span><span class="panel-label">Legend</span></a>
                    <a class="panel-close" role="button" data-toggle="collapse" tabindex="0" href="#panelLegend"><span class="esri-icon esri-icon-close" aria-hidden="true"></span></a>
                </div>
            </div>
            <div id="collapseLegend" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingLegend">
                <div class="panel-body">
                    <div id="legendDiv"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="calcite-panels calcite-panels-right calcite-bg-custom calcite-text-light calcite-bgcolor-dark panel-group" role="tablist" aria-multiselectable="true">

        <!-- Info Panel -->



        <div id="panelInfo" class="panel collapse in">
            <div id="headingInfo" class="panel-heading" role="tab">
                <div class="panel-title">
                    <a class="panel-toggle" role="button" data-toggle="collapse" href="#collapseInfo" aria-expanded="true" aria-controls="collapseInfo"><span class="esri-icon-notice-round" aria-hidden="true"></span><span class="panel-label">About</span></a>
                    <a class="panel-close" role="button" data-toggle="collapse" tabindex="0" href="#panelInfo"><span class="esri-icon esri-icon-close" aria-hidden="true"></span></a>
                </div>
            </div>
            <div id="collapseInfo" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingInfo">
                <div class="panel-body">
                    <p align="justify">This web map application was created by the Utah Geological Survey (UGS) in cooperation with the U.S. Bureau of Land Management (BLM) to show mineral resource information in Utah. Use the links below to download the map data. <br /><br />

                        <strong>Layer Information</strong></p>

                        <p><br /><strong>Utah Mineral Occurrence System (UMOS)</strong><a href="https://geology.utah.gov/apps/blm_mineral/appfiles/UMOS2021_05_05.zip" target="_blank"><span style="color: blue;"> (download)</span></a></p>
                        <p class="tab" style="padding-left: 10px;">A database of mineral occurrences, prospects, mines, and mineral resources in the state of Utah.</p>

                        <p><br /><strong>Mining Districts</strong>
<a href="https://ugspub.nr.utah.gov/publications/open_file_reports/ofr-695.pdf" target="_blank"><span style="color: blue;">(publication, </span></a>
<a href="https://geology.utah.gov/apps/blm_mineral/appfiles/Mining_Districts_20190116gdb.zip" target="_blank"><span style="color: blue;">GIS data)</span></a> 
                        <p class="tab" style="padding-left: 10px;">Locations of Utah’s mining districts with summaries of relevant information for each district.</p>

                    <p><br /><strong>Industrial Mineral Resource Potential </strong>
                    <a href="https://geology.utah.gov/apps/blm_mineral/appfiles/Utah_IM_GIS.zip" target="_blank"><span style="color: blue;">(download)</span></a> <br /><br /></p>
                    <p class="tab" style="padding-left: 10px;">Resource potential for various locatable industrial mineral commodities.</p>
                

                    <p><br /><strong>U.S. Bureau of Mines Wilderness Study Area (WSA) Mineral Land Assessment</strong></p>
                    <p class="tab" style="padding-left: 10px;">Mineral resource assessment reports of BLM Wilderness Study Areas prepared by the U.S. Bureau of Mines.</p>
                </div>
            </div>
        </div>

        <!-- Basemaps Panel -->

        <div id="panelBasemaps" class="panel collapse">
            <div id="headingBasemaps" class="panel-heading" role="tab">
                <div class="panel-title">
                    <a class="panel-toggle collapsed" role="button" data-toggle="collapse" href="#collapseBasemaps" aria-expanded="false" aria-controls="collapseBasemaps"><span class="esri-icon-basemap" aria-hidden="true"></span><span class="panel-label">Basemaps</span></a>
                    <a class="panel-close" role="button" data-toggle="collapse" tabindex="0" href="#panelBasemaps"><span class="esri-icon esri-icon-close" aria-hidden="true"></span></a>
                </div>
            </div>
            <div id="collapseBasemaps" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingBasemaps">
                <div class="panel-body">
                    <select id="selectBasemapPanel" class="form-control">
                        <option value="streets" data-vector="streets-vector">Streets</option>
                        <option value="satellite" data-vector="satellite">Satellite</option>
                        <option value="hybrid" data-vector="hybrid">Hybrid</option>
                        <option value="national-geographic" data-vector="national-geographic">National Geographic</option>
                        <option value="topo" data-vector="topo-vector" selected="">Topographic</option>
                        <option value="gray" data-vector="gray-vector">Gray</option>
                        <option value="dark-gray" data-vector="dark-gray-vector">Dark Gray</option>
                        <option value="osm" data-vector="osm">Open Street Map</option>
                        <option value="dark-gray" data-vector="streets-night-vector">Streets Night</option>
                        <option value="streets" data-vector="streets-navigation-vector">Streets Mobile</option>
                    </select>
                </div>
            </div>
        </div>





        <!-- Grid panelSearch panel -->
        <div id="panelGrid" class="panel collapse">
            <div id="headingInfo" class="panel-heading" role="tab">
                <div class="panel-title">
                    <a class="panel-toggle" role="button" data-toggle="collapse" href="#collapseGrid" aria-expanded="false" aria-controls="collapseGrid"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span><span class="panel-label">Search Results</span></a>
                    <a class="panel-close" role="button" data-toggle="collapse" data-target="#panelGrid"><span class="esri-icon esri-icon-close" aria-hidden="true"></span></a>
                </div>
            </div>
            <div id="collapseGrid" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingGrid">
                <div class="panel-body">


                    <div id="grid"></div>
                    <!--  <div id="results" class="results"></div>  -->

                </div>
            </div>
        </div>


        <!-- Attribute Details panel -->
        <div id="panelDetails" class="panel collapse">
            <div id="headingInfo" class="panel-heading" role="tab">
                <div class="panel-title">
                    <a class="panel-toggle" role="button" data-toggle="collapse" href="#collapseDetails" aria-expanded="true" aria-controls="collapseDetails"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span><span class="panel-label" id="details">Photos</span></a>
                    <a class="panel-close" role="button" data-toggle="collapse" data-target="#panelDetails"><span class="esri-icon esri-icon-close" aria-hidden="true"></span></a>
                </div>
            </div>
            <div id="collapseDetails" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingDetails">
                <div class="panel-body">

                    <div id="gallery">
                        <ul class="pictures" id="attDetails">
                </ul>
              </div>

                </div>
            </div>
        </div>

        <!-- Disclaimer panel -->
        <div id="panelDisclaimer" class="panel collapse">
            <div id="headingInfo" class="panel-heading" role="tab">
                <div class="panel-title">
                    <a class="panel-toggle" role="button" data-toggle="collapse" href="#collapseDisclaimer" aria-expanded="true" aria-controls="collapseDisclaimer"><span class="esri-icon-notice-triangle" aria-hidden="true"></span><span class="panel-label">Disclaimer</span></a>
                    <a class="panel-close" role="button" data-toggle="collapse" data-target="#panelDisclaimer"><span class="esri-icon esri-icon-close" aria-hidden="true"></span></a>
                </div>
            </div>
            <div id="collapseDisclaimer" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingDisclaimer">
                <div class="panel-body">

                    <p style="text-align: justify;">Although this product represents the work of professional scientists, the Utah Department of Natural Resources, Utah Geological Survey and U.S. Department of the Interior, U.S. Bureau of Land Management make no warranty, expressed or implied, regarding its suitability for any particular use. The Utah Department of Natural Resources, Utah Geological Survey, and U.S. Department of the Interior, U.S. Bureau of Land Management shall not be liable under any circumstances for any direct, indirect, special, incidental, or consequential damages with respect to claims by users of this product. The Utah Geological Survey and U.S. Bureau of Land Management do not guarantee accuracy or completeness of the data. The views and conclusions contained in this document are those of the authors and should not be interpreted as necessarily representing the official policies, either expressed or implied, of the U.S. Government. Persons or agencies using these data specifically agree not to misrepresent the data, nor to imply that changes they made were approved by the Utah Geological Survey, and should indicate the data source and any modifications made on plots, digital copies, derivative products, and in metadata. The authors' determinations of resource potential DO NOT imply a determination of locatability for claim-staking purposes. The authors' determinations of resource potential also DO NOT imply potential for development of mineral resources.</p>
                    <p>The Utah Geological Survey presents U.S. Bureau of Mines Mineral Land Assessments as a public service and has no role in the production or approval of these reports. The Utah Department of Natural Resources, Utah Geological Survey makes no warranty, expressed or implied, regarding the suitability of these reports for a particular purpose and shall not be liable under any circumstances for any direct, indirect, special, incidental, or consequential damages with respect to claims by users of this product.</p>

                </div>
            </div>
        </div>

    </div> <!-- /.calcite-panels -->

    <script src="https://momentjs.com/downloads/moment.js"></script>

    <script src="lightbox2/dist/js/lightbox-plus-jquery.min.js"></script>

    <script type="text/javascript">
        var dojoConfig = {
            packages: [{
                    name: "bootstrap",
                    location: "https://esri.github.io/calcite-maps/dist/vendor/dojo-bootstrap"
                },
                {
                    name: "calcite-maps",
                    location: "https://esri.github.io/calcite-maps/dist/js/dojo"
                }
            ]
        };
    </script>

    <!-- ArcGIS JS 4 -->
    <script src="https://js.arcgis.com/4.19/"></script>


    <script>
var app;
require([
    "esri/Map",
    "esri/Basemap",
    "esri/portal/Portal",
    "esri/Graphic",
    "esri/layers/FeatureLayer",
    "esri/layers/GroupLayer",
    "esri/views/MapView",
    "esri/views/SceneView",
    "esri/popup/content/TextContent",
    "esri/popup/content/AttachmentsContent",
    "esri/tasks/support/RelationshipQuery",
    "esri/widgets/Search",
    "esri/core/watchUtils",
    "esri/widgets/Home",
    "esri/widgets/Zoom",
    "esri/widgets/Compass",
    "esri/widgets/Locate",
    "esri/widgets/Legend",
    "esri/widgets/BasemapToggle",
    "esri/widgets/LayerList",
    "esri/tasks/QueryTask",
    "esri/tasks/support/Query",
    "dojo/query",
    "dojo/_base/declare",
    "dojo/request",
    // Calcite-maps
    "calcite-maps/calcitemaps-v0.10",
    "calcite-maps/calcitemaps-arcgis-support-v0.10",
    // Bootstrap
    "bootstrap/Collapse",
    "bootstrap/Dropdown",
    "bootstrap/Tab"

], function(Map, Basemap, Portal, Graphic, FeatureLayer, GroupLayer, MapView, SceneView, TextContent, AttachmentsContent, RelationshipQuery, Search, watchUtils, Home, Zoom, Compass, Locate, Legend, BasemapToggle, LayerList, QueryTask, Query, query, declare, request, CalciteMaps, CalciteMapsArcGIS) {

    // App
    app = {
        zoom: 8,
        center: [-112, 39.5],
        basemap: "terrain",
        viewPadding: {
            top: 50,
            bottom: 0
        },
        uiPadding: {
            top: 15,
            bottom: 15
        },
        map: null,
        mapView: null,
        sceneView: null,
        activeView: null,
        searchWidgetNav: null,
        containerMap: "mapViewDiv",
        containerScene: "sceneViewDiv"
    };
    // Map 
    app.map = new Map({
        basemap: app.basemap,
        //ground: "world-elevation"
    });
    // 2D View
    app.mapView = new MapView({
        container: app.containerMap, // deactivate
        map: app.map,
        zoom: 8,
        center: [-112, 39.5],
        padding: app.viewPadding,
        ui: {
            components: ["zoom", "compass", "home"],
            padding: app.uiPadding
        }
    });
    // 3D View
    app.sceneView = new SceneView({
        container: null, // activate
        map: app.map,
        zoom: app.zoom,
        center: app.center,
        padding: app.viewPadding,
        ui: {
            padding: app.uiPadding
        }
    });
    // Active view is scene
    setActiveView(app.mapView);
    // Create search widget
    app.searchWidgetNav = new Search({
        container: "searchNavDiv",
        view: app.activeView,
        includeDefaultSources: false,
    });
    // Wire-up expand events
    CalciteMapsArcGIS.setSearchExpandEvents(app.searchWidgetNav);
    CalciteMapsArcGIS.setPopupPanelSync(app.mapView);
    CalciteMapsArcGIS.setPopupPanelSync(app.sceneView);
    // Menu UI - change Basemaps
    query("#selectBasemapPanel").on("change", function(e) {
        app.mapView.map.basemap = e.target.options[e.target.selectedIndex].dataset.vector;
        app.sceneView.map.basemap = e.target.value;
    });
    // Tab UI - switch views
    query(".calcite-navbar li a[data-toggle='tab']").on("click", function(e) {
        if (e.target.text.indexOf("2D") > -1) {
            syncViews(app.sceneView, app.mapView);
            setActiveView(app.mapView);
        } else {
            syncViews(app.mapView, app.sceneView);
            setActiveView(app.sceneView);
        }
        syncSearch(app.activeView);
    });
    // Views
    function syncViews(fromView, toView) {
        var viewPt = fromView.viewpoint.clone();
        fromView.container = null;
        if (fromView.type === "3d") {
            toView.container = app.containerMap;
        } else {
            toView.container = app.containerScene;
        }
        toView.viewpoint = viewPt;
        toView.padding = app.viewPadding;
    }
    // Search Widget
    function syncSearch(view) {
        app.searchWidgetNav.view = view;
        if (app.searchWidgetNav.selectedResult) {
            watchUtils.whenTrueOnce(view, "ready", function() {
                app.searchWidgetNav.autoSelect = false;
                app.searchWidgetNav.search(app.searchWidgetNav.selectedResult.name);
                app.searchWidgetNav.autoSelect = true;
            });
        }
    }
    // Active view
    function setActiveView(view) {
        app.activeView = view;
    }

    var home = new Home({
        view: app.activeView
    });
    app.activeView.ui.add(home, "top-left");

    var locate = new Locate({
        view: app.activeView
    });
    app.activeView.ui.add(locate, "top-left");

    // Panel widgets - add legend
    var legendWidget = new Legend({
        //container: "legendDiv",
        view: app.activeView
    });

    var photoAction = {
            title: "Photos",
            id: "photo-gallery",
            className: "esri-icon-media"
        };



    //Panel widgets - layerlist
    var layerList = new LayerList({
        view: app.activeView,
        container: "legendDiv",
        listItemCreatedFunction: function(event) {
            var item = event.item;

            setTimeout(function() {  //function to change tooltips for each layer in layerlist
            var eyeArr = query('.esri-layer-list__item-toggle');
            var titleArr = query('.esri-layer-list__item-title');
           

            if(eyeArr.length){
              eyeArr.map(function(node){
                node.title = "Toggle Layer On/Off";
              });
            } 

            if(titleArr.length){
              titleArr.map(function(node){
                node.title = "Toggle Layer On/Off";
              });
            }




          }, 500);
            if (item.layer.type != "group") { // don't show legend twice
                item.panel = {
                    content: "legend",
                    open: true
                };
                if (item.layer.geometryType == "polygon") { //gets rid of the opacity tool for the point features

                    item.actionsSections = [
                        [{
                            title: "Increase opacity",
                            className: "esri-icon-up",
                            id: "increase-opacity"
                        }, {
                            title: "Decrease opacity",
                            className: "esri-icon-down",
                            id: "decrease-opacity"
                        }]
                    ];
                };
            }
        }
    });



    layerList.on("trigger-action", function(event) {

        // Capture the action id.
        var id = event.action.id;
        var title = event.item.title;

        if (title === "Mining Districts") {
            layer = miningDistricts;
        } else if (title === "Land Ownership") {
            layer = adminBounds;
        } else if (title === "Bentonite") {
            layer = bentonite;
        } else if (title === "Gypsum") {
            layer = gypsum;
        } else if (title === "Limestone") {
            layer = limestone;
        } else {
            layer = dolomite;
        }

        if (id === "increase-opacity") {

            // if the increase-opacity action is triggered, then
            // increase the opacity of the GroupLayer by 0.1

            if (layer.opacity < 1) {
                layer.opacity += 0.1;
            }
        } else if (id === "decrease-opacity") {

            // if the decrease-opacity action is triggered, then
            // decrease the opacity of the GroupLayer by 0.1

            if (layer.opacity > 0) {
                layer.opacity -= 0.1;
            }
        }

    });



    //Popup Templates


    rockHoundingContent = function(value, key, data) {
        var content = "";

        if (key === "Material") {
            if (data.Material) {
                content += "<span class='bold' title='Name'><b>Rockhounding </b></span><b>" + data.Material + " Site</b>";
            }
        }

        if (key === "Material_Description") {
            if (data.Material_Description) {
                content += "<span class='bold' title='Description'><b>Material Description: </b></span>" + data.Material_Description;
            }
        }

        if (key === "Site_Description_Geology") {
            if (data.Site_Description_Geology) {
                content += "<br><span class='bold' title='Description'><b>Site Geology: </b></span>" + data.Site_Description_Geology;
            }
        }

        if (key === "Directions_To_Site") {
            if (data.Directions_To_Site) {
                content += "<br><span class='bold' title='Description'><b>Directions To Site: </b></span>" + data.Directions_To_Site;
            }
        }

        return content;

    }

    geoSitesContent = function(feature) {
        var content = "";


            if (feature.graphic.attributes.Picture) {
                content += "<span class='bold' title='Photo'></span>" + "<a href='{Picture}' data-lightbox='photo1' target='_blank'> <img src='{Picture}' width='150' height='100'></a><br>";
            }
        

        if (feature.graphic.attributes.Name) {
            content += "<span class='bold' title='Name'></span><b>{Name}</b><br>";
        }


            if (feature.graphic.attributes.Description) {
                content += "<br><span class='bold' title='Description'><b>Description: </b></span>{Description}<br>";
            }
        

        return content;

    }

    miningContent = function(feature) {
        console.log(feature);

        var content = "";
        var attachmentsElement = "";

        var attachmentsElement = new AttachmentsContent({
                displayType: "list"
            });

        var content = new TextContent();
        var commodity = feature.graphic.attributes.Commodity;
        var organized = feature.graphic.attributes.Organized;
        var productive = feature.graphic.attributes.Productive;
        var shortTons = feature.graphic.attributes.Short_Tons;
        var totalDollar = feature.graphic.attributes.Total_Dollar_Value;


            // if (feature.graphic.attributes.District) {
            //     content += "<span class='bold' title='District'></span><b>{District} Mining District</b><br>";
            // }
        

            if (commodity) {
                content.text =  "<span class='bold' title='Commodity'><b>Commodity: </b></span>" + commodity + "</b><br>";
            }
        

            if (organized) {
                content.text += "<span class='bold' title='Organized'><b>Organized: </b></span>" + organized + "</b><br>";
            }
        

            if (productive) {
                content.text += "<span class='bold' title='Productive'><b>Productive: </b></span>" + productive + "</b><br>";
            }
        
            if (shortTons) {
                content.text += "<span class='bold' title='Short Tons'><b>Short Tons: </b></span>" + shortTons + "</b><br>";
            }
        

            if (totalDollar) {
                
                content.text += "<span class='bold' title='Total Dollar Value'><b>Total Dollar Value: </b></span>" + totalDollar.toLocaleString('en-US', {
                    style: 'currency',
                    currency: 'USD',
                }) + "</b><br>*data current through 2017";
            }

            console.log(content);



            return [content, attachmentsElement];


    }

    const template = {
            title: "<b>{District} Mining District</b>",
            content: miningContent,
            //actions: [photoAction],
            fieldInfos: [
            {
              fieldName: "District"
            },
            {
              fieldName: "Commodity"
            },
            {
              fieldName: "Short_Tons"
            },
            {
              fieldName: "Organized"
            },
            {
              fieldName: "Productive"
            },
            {
              fieldName: "Commodity"
            }
          ],

        }

    industrialMinContent = function(feature) {
        var content = "";


        if (feature.graphic.attributes.AGE) {
                content += "<span class='bold' title='Age'><b>Age: </b></span>{AGE}</b><br>";
        }

            if (feature.graphic.attributes.UNITNAME) {
                content += "<span class='bold' title='UNIT NAME'><b>Unit Name: </b></span>{UNITNAME}</b><br>";
            }
        

        if (feature.graphic.attributes.Commodity) {
            if (feature.graphic.attributes.Commodity == "Gypsum") {
                content += "<br><span class='bold' title='Show complete report for {Commodity}'></span>" + "<a href='https://ugspub.nr.utah.gov/publications/blm_mineral_resources/Gypsum.pdf' target='_blank'><b>Layer Information</b></a>";
            } else if (feature.graphic.attributes.Commodity == "Dolomite") {
                content += "<br><span class='bold' title='Show complete report for {Commodity}'></span>" + "<a href='https://ugspub.nr.utah.gov/publications/blm_mineral_resources/Dolomite.pdf' target='_blank'><b>Layer Information</b></a>";
            } else if (feature.graphic.attributes.Commodity == "Limestone") {
                content += "<br><span class='bold' title='Show complete report for {Commodity}'></span>" + "<a href='https://ugspub.nr.utah.gov/publications/blm_mineral_resources/Limestone.pdf' target='_blank'><b>Layer Information</b></a>";
            }
        }


        return content;

    }

    bentMinContent = function(feature) {
        console.log(feature);
        var content = "";

       
            if (feature.graphic.attributes.Age) {
                content += "<span class='bold' title='Age'><b>Age: </b></span>{Age}</b><br>";
            }
        
        
            if (feature.graphic.attributes.UnitName) {
                content += "<span class='bold' title='UNIT NAME'><b>Unit Name: </b></span>{UnitName}</b><br>";
            }
        
            if (feature.graphic.attributes.Commodity) {
                content += "<br><span class='bold' title='Show complete report for {Commodity}'></span>" + "<a href='https://ugspub.nr.utah.gov/publications/blm_mineral_resources/Bentonite.pdf' target='_blank'><b>Layer Information</b></a><br>";
            }
        


        return content;

    }
    
    silicaContent = function(feature) {

        var content = "";

        
        if (feature.graphic.attributes.Age) {
                content += "<span class='bold' title='Age'><b>Age: </b></span>{Age}</b><br>";
            }
        
        
            if (feature.graphic.attributes.UnitName) {
                content += "<span class='bold' title='UNIT NAME'><b>Unit Name: </b></span>{UnitName}</b><br>";
            }

      
            if (feature.graphic.attributes.res_pot_rank) {
                content += "<br><span class='bold' title='Show complete report for Silica'></span>" + "<a href='https://ugspub.nr.utah.gov/publications/blm_mineral_resources/Silica.pdf' target='_blank'><b>Layer Information</b></a><br>";
            }
            return content;

    }



    wsaContent = function(feature) {
        var content = "";

       
            if (feature.graphic.attributes.wsa) {
                content += "<span class='bold' title='Age'><b>WSA: </b></span>{wsa}</b><br>";
            }
        



      
             if (feature.graphic.attributes.url) {
                 content += "<br><span class='bold' title='Download Mineral Land Assessment for Wilderness Study Area'></span>" + "<a href='{url}' target='_blank'><b>Download Mineral Land Assessment for Wilderness Study Area</b></a><br>";
            }
         


        return content;

    }






    const umosRenderer = {
          type: "unique-value", // autocasts as new SimpleRenderer()
          field: "TYPE",
          legendOptions: {
                  title: "Commodity Type"
              },
          uniqueValueInfos: [
                {
                  value: "Unspecified",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "rgb(78, 78, 78)",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5  
                    }
                  }
                },                {
                  value: "Energy",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "rgb(255, 211, 127)",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },                {
                  value: "Industrial Mineral",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "rgb(225, 225, 225)",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },                {
                  value: "Industrial Mineral - Energy",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "rgb(214, 157, 188)",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },                {
                  value: "Metal",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "rgb(158,215,174)",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },                {
                  value: "Metal - Energy",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "rgb(158,170,215)",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },                {
                  value: "Metal - Industrial Mineral",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "rgb(102,153,205)",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },                {
                  value: "Metal - Industrial Mineral - Energy",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "rgb(68,101,137)",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },
            ],
            visualVariables: [
            {
              type: "size",
              valueExpression: "$feature.Prod_Value_symbol",
              legendOptions: {
                  title: "Production"
              },
              stops: [
                {
                  value: 0,
                  size: 6,
                  label: "None"
                },
                {
                  value: 1,
                  size: 10,
                  label: "Small"
                },
                {
                  value: 2,
                  size: 14,
                  label: "Medium"
                },
                {
                  value: 3,
                  size: 18,
                  label: "Large"
                }
              ]
            },

        ]
    };


    //critical minerals renderer
    const critMineralsRenderer = {
          type: "unique-value", // autocasts as new SimpleRenderer()
          field: "CriticalMineral",
          legendOptions: {
                  title: "Mineral"
              },
          uniqueValueInfos: [
                {
                  value: "Alunite",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "#00008b",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5  
                    }
                  }
                },                {
                  value: "Antimony",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "#0000ff",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },                {
                  value: "Arsenic",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "#00bfff",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },                {
                  value: "Barite",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "#00ffff",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },                {
                  value: "Beryllium",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "#808000",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },                {
                  value: "Bismuth",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "#008000",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },                {
                  value: "Cobalt",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "#adff2f",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },                {
                  value: "Fluorite",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "#98fb98",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }                
                },
                {
                    value: "Gallium-Germanium",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "#f0e68c",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },
                {
                    value: "Helium",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "#ffd700",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },
                {
                    value: "Indium",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "#ff8c00",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },
                {
                    value: "Lithium",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "#fa8072",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },
                {
                    value: "Magnesium",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "#ff0000",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },
                {
                    value: "Platinum-Palladium",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "#8b0000",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },
                {
                    value: "REE",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "#ff1493",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },
                {
                    value: "Rhenium",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "#ff00ff",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },
                {
                    value: "Tellurium",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "#dda0dd",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },
                {
                    value: "Tin",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "#ba55d3",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },
                {
                    value: "Titanium and/or Zirconium",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "#483d8b",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },
                {
                    value: "Tungsten",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "#2f4f4f",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },
                {
                    value: "Uranium",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "#c0c0c0",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                },
                {
                    value: "Vanadium",
                  symbol: {
                    type: "simple-marker",
                    size: 6,
                    color: "#d8cef2",
                    outline: {  
                        color: [ 90,90,90 ],
                    width: 0.5
                    }
                  }
                }
            ],
            visualVariables: [
            {
              type: "size",
              valueExpression: "$feature.Stage_Value_Symbol",
              legendOptions: {
                  title: "Production"
              },
              stops: [
                {
                  value: 0,
                  size: 6,
                  label: "Other deposit"
                },
                {
                  value: 1,
                  size: 10,
                  label: "Potential Resource"
                },
                {
                  value: 2,
                  size: 14,
                  label: "Established Resource"
                },
                {
                  value: 3,
                  size: 18,
                  label: "Active Producer"
                }
              ]
            },

        ]
    };






      

    //remove panels when user clicks on map

    app.activeView.on("click", function(event) {
        app.activeView.graphics.removeAll();
        query("#panelDetails").removeClass("in");
    });

    //renderers
    const rockHoundRenderer = {
        type: "simple", // autocasts as new SimpleRenderer()
        symbol: {
            type: "simple-marker", // autocasts as new SimpleMarkerSymbol()
            size: 8,
            color: [255, 71, 68],
            outline: null
        }
    };

    const geoSitesRenderer = {
        type: "simple", // autocasts as new SimpleRenderer()
        symbol: {
            type: "simple-marker", // autocasts as new SimpleMarkerSymbol()
            size: 8,
            color: [66, 194, 244],
            outline: null
        }
    };



    //add feature layers

    // const rockHounding = new FeatureLayer({
    //     url: "https://maps.dnr.utah.gov/arcgis/rest/services/UGS/BLM_Rockhounding_Sites/MapServer/0",
    //     title: "Rockhounding Sites on BLM Land",
    //     outFields: ["*"],
    //     renderer: rockHoundRenderer,
    //     popupTemplate: {
    //         title: "<b>{Material:rockHoundingContent}</b>",
    //         content: "{Material_Description:rockHoundingContent}<br>{Site_Description_Geology:rockHoundingContent}<br>{Directions_To_Site:rockHoundingContent}"
    //     },
    //     visible: false,
    // });

    // const geoSites = new FeatureLayer({
    //     url: "https://webmaps.geology.utah.gov/arcgis/rest/services/Energy_Mineral/BLM_Mineral_Resources/MapServer/8",
    //     title: "GeoSights on BLM Land",
    //     outFields: ["*"],
    //     renderer: geoSitesRenderer,
    //     popupTemplate: {
    //         title: "<b>{Name:geoSitesContent}</b>",
    //         content: "{Picture:geoSitesContent}{Description:geoSitesContent}"
    //     },
    //     visible: false,
    // });

    var minedistrictRenderer = {
  type: "simple",  // autocasts as new UniqueValueRenderer()
  legendOptions: {
                  title: "Metalliferous Mining Districts"
              },
  symbol: { type: "simple-fill",  // autocasts as new SimpleFillSymbol()
      color: "#ffcc80",
      outline: {
    width: 1,
    color: "#ff9900"
    }, },  // autocasts as new SimpleFillSymbol()

};

const umos = new FeatureLayer({
    url: "https://services.arcgis.com/ZzrwjTRez6FJiOq4/arcgis/rest/services/Metal_Mineral_Resources_web_View/FeatureServer/12",
    title: "Utah Mineral Occurrence System",
    outFields: ["*"],
    renderer: umosRenderer,
    popupTemplate: {
        title: "<b>{SITE_NAME}</b>",
        content: "<span class='bold' title='Commodity'><b>Commodity: </b></span>{COMMODITY}</b><br>" +
        "<span class='bold' title='Commodity'><b>Ore Mineral: </b></span>{ORE_MINERALS}</b><br>" +
                    "<span class='bold' title='Commodity Type'><b>Commodity Type: </b></span>{TYPE}</b><br>" +
                    "<span class='bold' title='Production'><b>Production: </b></span>{PRODUCTION}</b><br>" +
                    "<span class='bold' title='Deposit Size'><b>Deposit Size: </b></span>{DEP_SIZE}</b><br>" +
                    "<span class='bold' title='Mining District'><b>Mining District: </b></span>{DISTRICT}</b><br>" +
                    "<span class='bold' title='County'><b>County: </b></span>{COUNTY}</b><br>" +
                    "<br><a href='https://geology.utah.gov/apps/blm_mineral/appfiles/UMOS%20Explanation.pdf' target='_blank'><span style='color: blue;'> UMOS Explanation</span></a>",
        fieldInfos: [{
            fieldName: "COMMODITY",
            },{
            fieldName: "TYPE",
            },{
            fieldName: "PRODUCTION",
        },{
            fieldName: "DEP_SIZE",
        },{
            fieldName: "DISTRICT",
        },{
            fieldName: "PRODUCTION",
            },{
                fieldName: "ORE_MINERAL",
            }]
    },
    visible: false
});

const critMinerals = new FeatureLayer({
    url: 'https://services.arcgis.com/ZzrwjTRez6FJiOq4/ArcGIS/rest/services/Metal_Mineral_Resources_web_View/FeatureServer/18',
    title: "Critical Minerals",
    outFields: ["*"],
    renderer: critMineralsRenderer,
    visible: false
});

const critMinPolys = new FeatureLayer({
    url:'https://services.arcgis.com/ZzrwjTRez6FJiOq4/ArcGIS/rest/services/Metal_Mineral_Resources_web_View/FeatureServer/14',
    title: "Critical Mineral Areas",
    visible: false
})


    const miningDistricts = new FeatureLayer({
        url: "https://services.arcgis.com/ZzrwjTRez6FJiOq4/arcgis/rest/services/Metal_Mineral_Resources_web_View/FeatureServer/6",
        title: "Metalliferous Mining Districts",
        outFields: ["*"],
        opacity: 0.5,
        popupTemplate: template,
        //renderer: minedistrictRenderer, 
        visible: true,
    });  

    const mineralLandAssessments = new FeatureLayer({
        url: "https://services.arcgis.com/ZzrwjTRez6FJiOq4/arcgis/rest/services/Metal_Mineral_Resources_web_View/FeatureServer/11",
        title: "WSA Mineral Land Assessment",
        opacity: 0.5,
        outFields: ["*"],

        popupTemplate: {
            title: "<b>U.S. Bureau of Mines Wilderness Study Area (WSA) Mineral Land Assessment</b>",
            content: wsaContent

        },
        visible: false,
    });

    const silica = new FeatureLayer({
        url: "https://services.arcgis.com/ZzrwjTRez6FJiOq4/ArcGIS/rest/services/Metal_Mineral_Resources_web_View/FeatureServer/5",
        title: "Silica",
        opacity: 0.5,
        outFields: ["*"],

        popupTemplate: {
            title: "<b>Silica Potential</b>",
            content: silicaContent

        },
        visible: false,
    });

    const bentonite = new FeatureLayer({
        url: "https://services.arcgis.com/ZzrwjTRez6FJiOq4/ArcGIS/rest/services/Metal_Mineral_Resources_web_View/FeatureServer/1",
        title: "Bentonite",
        opacity: 0.5,
        outFields: ["*"],

        popupTemplate: {
            title: "<b>Bentonite Potential</b>",
            content: bentMinContent

        },
        visible: false,
    });

    const dolomite = new FeatureLayer({
        url: "https://services.arcgis.com/ZzrwjTRez6FJiOq4/ArcGIS/rest/services/Metal_Mineral_Resources_web_View/FeatureServer/2",
        title: "Dolomite",
        outFields: ["*"],
        opacity: 0.5,

        popupTemplate: {
            title: "<b>Dolomite Potential</b>",
            content: industrialMinContent
        },
        visible: false,
    });

    const gypsum = new FeatureLayer({
        url: "https://services.arcgis.com/ZzrwjTRez6FJiOq4/ArcGIS/rest/services/Metal_Mineral_Resources_web_View/FeatureServer/3",
        title: "Gypsum",
        outFields: ["*"],
        opacity: 0.5,

        popupTemplate: {
            title: "<b>Gypsum Potential</b>",
            content: industrialMinContent
        },
        visible: false,
    });

    const limestone = new FeatureLayer({
        url: "https://services.arcgis.com/ZzrwjTRez6FJiOq4/ArcGIS/rest/services/Metal_Mineral_Resources_web_View/FeatureServer/4",
        title: "Limestone",
        outFields: ["*"],
        opacity: 0.5,

        popupTemplate: {
            title: "<b>Limestone Potential</b>",
            content: industrialMinContent
        },
        visible: false,
    });

    const industrialMins = new GroupLayer({
        title: "Industrial Mineral Resource Potential",
        visible: true,
        layers: [bentonite, dolomite, gypsum, limestone, silica]
    });

    const adminlabelClass = { // autocasts as new LabelClass()
        symbol: {
            type: "text", // autocasts as new TextSymbol()
            color: "rgba(125, 125, 125, 0.51)",
            //haloColor: "black",
            font: { // autocast as new Font()
                family: "sans-serif",
                size: 10,
                weight: "bold"
            }
        },
        labelPlacement: "always-horizontal",
        labelExpressionInfo: {
            expression: "$feature.ADMIN"
        }
    };

    var adminRenderer = {
  type: "unique-value",  // autocasts as new UniqueValueRenderer()
  field: "AGENCY",
  //defaultSymbol: { type: "simple-fill" },  // autocasts as new SimpleFillSymbol()
  uniqueValueInfos: [{
    // All features with value of "North" will be blue
    value: "BLM",
    symbol: {
      type: "simple-fill",  // autocasts as new SimpleFillSymbol()
      color: "#FEE679",
      outline: {
    width: 0,
    color: "gray"
    },
}
  }, {
    // All features with value of "East" will be green
    value: "SITLA",
    symbol: {
      type: "simple-fill",  // autocasts as new SimpleFillSymbol()
      color: "#73B2FF",
      outline: {
    width: 0,
    color: "gray"
    },
}
  }, {
    // All features with value of "South" will be red
    value: "NPS",
    symbol: {
      type: "simple-fill",  // autocasts as new SimpleFillSymbol()
      color: "#89CD66",
      outline: {
    width: 0,
    color: "gray"
    }
}
  }, {
    // All features with value of "West" will be yellow
    value: "DNR",
    symbol: {
      type: "simple-fill",  // autocasts as new SimpleFillSymbol()
      color: "#267300",
      outline: {
    width: 0,
    color: "gray"
    }
}
  }, {
    // All features with value of "West" will be yellow
    value: "DOD",
    symbol: {
      type: "simple-fill",  // autocasts as new SimpleFillSymbol()
      color: "#AAAAAA",
      outline: {
    width: 0,
    color: "gray"
    }
}
  }, {
    // All features with value of "West" will be yellow
    value: "USFS",
    symbol: {
      type: "simple-fill",  // autocasts as new SimpleFillSymbol()
      color: "#89CD66",
      outline: {
    width: 0,
    color: "gray"
    }
}
  }, {
    // All features with value of "West" will be yellow
    value: "Tribal",
    symbol: {
      type: "simple-fill",  // autocasts as new SimpleFillSymbol()
      color: "#FDB46C",
      outline: {
    width: 0,
    color: "gray"
  }
    }
  }],

};

    const adminBounds = new FeatureLayer({
        url: "https://gis.trustlands.utah.gov/server/rest/services/Ownership/UT_SITLA_Ownership_LandOwnership/FeatureServer",
        title: "Land Ownership",
        outFields: ["*"],
        legendEnabled: true,
        opacity: 0.15,
        visible: false,
        renderer: adminRenderer,
        //labelingInfo: [adminlabelClass],

    });

    const countylabelClass = { // autocasts as new LabelClass()
        symbol: {
            type: "text", // autocasts as new TextSymbol()
            color: "rgba(125, 125, 125, 0.51)",
            //haloColor: "black",
            font: { // autocast as new Font()
                family: "sans-serif",
                size: 16,
                weight: "bold"
            }
        },
        labelPlacement: "always-horizontal",
        labelExpressionInfo: {
            expression: "$feature.NAME"
        }
    };

    const countyLayer = new FeatureLayer({
        url: "https://services.arcgis.com/ZzrwjTRez6FJiOq4/ArcGIS/rest/services/Metal_Mineral_Resources_web_View/FeatureServer/10",
        popupEnabled: false,
        name: "Counties",
        title: "Counties",
        listMode: "hide",
        opacity: 0.5,
        labelingInfo: [countylabelClass],
    });

    const refLayers = new GroupLayer({
        title: "Reference Layers",
        visible: false,
        layers: [adminBounds, countyLayer]
    });

    const critMinGroup = new GroupLayer({
        title: "Critical Minerals",
        visible: true,
        layers: [critMinerals, critMinPolys]
    });

    app.activeView.map.add(countyLayer);
    app.activeView.map.add(adminBounds);
    app.activeView.map.add(mineralLandAssessments);


    app.activeView.map.add(industrialMins);
    app.activeView.map.add(miningDistricts);
    app.activeView.map.add(critMinGroup);
    app.activeView.map.add(umos);

    watchUtils.watch(silica, 'visible', function(e) {
        console.log(e);
        if (e == true){
        //var labelArr = query('[aria-labelledby$="object-27__title"]');

        //document.querySelector("#legendDiv > ul > li:nth-child(2) > div.esri-layer-list-panel > div > div > div > div > div > div > div.esri-legend__layer-caption").innerHTML = "";

        }
    });
    


    app.activeView.popup.on("trigger-action", function(event) {
        
            // Execute the photoGallery() function if the photo action is clicked
            if (event.action.id === "photo-gallery") {
                photoGallery();
            }
        });

        //console.log(app.activeView)

// //photos action code
watchUtils.when(app.activeView.popup, "selectedFeature", function(evt) {

    if (evt.layer.title == "Metalliferous Mining Districts") {

query("#panelInfo").removeClass("in");
query("#panelDetails").removeClass("in");
query("#panelInventory").removeClass("in");
//console.log(app.activeView.popup.actions);
//app.activeView.popup.actions.splice(1, 2);


objectID = evt.attributes.OBJECTID;
//console.log(objectID);  
//query the well layer
var queryTask = new QueryTask({
    url: "https://services.arcgis.com/ZzrwjTRez6FJiOq4/ArcGIS/rest/services/Metal_Mineral_Resources_web_View/FeatureServer/6"
});
//query the well layers related table for photos
relationQuery = new RelationshipQuery({
    objectIds: [objectID],
    outFields: ["URL", "Photo_Label", "Locality", "Mineral", "mining_district"],
    returnGeometry: true,
    relationshipId: 0,
    //where: "1=1"
});
console.log(relationQuery);

queryTask.executeRelationshipQuery(relationQuery).then(function (rslts) {
    console.log(rslts);

    document.getElementById("attDetails").innerHTML = "";
    var features = rslts[objectID].features;

    if (features) {

        //console.log("Found Features");
        app.activeView.popup.actions.push(photoAction);

        // //adds labels for popup action buttons. for some reason having more than two custom actions removes the labels from all of them
        // setTimeout(labelButtons, 100)

        // function labelButtons() {
        //     var stringZoom = "Zoom To";
        //     var spanZoom = document.createElement("SPAN");
        //     spanZoom.className = "esri-popup__action-text";
        //     spanZoom.innerHTML = stringZoom;
        //     var actionButton = document.querySelectorAll('.esri-popup__feature-buttons .esri-popup__action');
        //     var children = actionButton[0].childNodes.length;
        //     if (children > 1) {} else {
        //         actionButton[0].appendChild(spanZoom);
        //     }


        //     var stringPho = "Photos";
        //     var spanPho = document.createElement("SPAN");
        //     spanPho.className = "esri-popup__action-text";
        //     spanPho.innerHTML = stringPho;
        //     actionButton[1].appendChild(spanPho);

        // }



    } else {
        query("#panelDetails").removeClass("in");
        query("#collapseDetails").removeClass("in");
    }

    features.forEach(function(ftr) {
        var t = ftr.attributes;
        var newURL = t.URL;
        //var string = fileURL.substr(3);
        var name = t.Photo_Label;
        // var type = t.Type;
        // var display = t.Usage;
        // var tDepth = t.Top_Depth;
        // var bDepth = t.Bottom_Depth;
        //console.log(fileURL);
        //var newURL = fileURL.replace(/\\/g, "/");
        //console.log(newURL);
        //if (display == "PUBLIC" && name.match(/.jpg/) || name.match(/.JPG/)) {
        if (newURL.match(/.jpg/) || newURL.match(/.JPG/)) {
            document.getElementById("attDetails").innerHTML += "<li><img data-original='https://geology.utah.gov/apps/" + newURL + "' src='https://geology.utah.gov/apps/" + newURL + "'  alt='" + name + " '></li>";
        }
    });
})
.catch(function (error) {
  //console.log("query task error", error);
});
}
app.activeView.popup.actions = [];
});


        // show or hide any open calicite panels when user clicks for attribute details
        function showHideCalcitePanels(showPanel, showCollapse) {
            // hide all windows
            //query(".panel-collapse").query(".panel .in").collapse("hide");   //close any open panels
            query(".panel.in").removeClass("in"); //close any open panels
            query(".panel-collapse").removeClass("in");

            // if specified show this calcite panel
            if (showPanel) {
                //query(showPanel).query(showCollapse).addClass("in");
                query(showPanel).collapse("show"); // so I use these instead
                query(showCollapse).collapse("show");
            }
        }
    


        function photoGallery() {

            query("#panelInfo").removeClass("in");
            var viewer;
            app.activeView.on('click', function() {
                viewer.destroy();
                // -> true
            }, false);

            showHideCalcitePanels("#panelDetails", "#collapseDetails");
            viewer = new Viewer(gallery, {
                url: 'data-original',
            });
            //console.log(viewer);

        }

                // Watch when the popup is visible
            app.mapView.popup.watch("visible", function(event) {
            // Grab the features of the popup
            features = app.mapView.popup.features;
        });

        



});
  </script>

   <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <!-- jQuery (for Bootstrap's JavaScript plugins). NOTE: You can also use pure Dojo. See examples. -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all  plugins or individual files as needed
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>  -->

</body>
</html>